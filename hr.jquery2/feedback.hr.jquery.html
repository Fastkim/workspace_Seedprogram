<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>hr</title>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css' rel='stylesheet'>
        <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'>
        <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js'></script>
        <script src='https://code.jquery.com/jquery-3.6.0.min.js'></script>
        <script>
            let laborers = []  // 데이터베이스로 사용할 array, 1차원 타입
            let laborerId = function* getLaborerId() { // generator
                let laborerId = 1
                while(true) yield laborerId++
            } () // business logic 

            function isVal(field) {
                let isGood = false // boolean 초기화 기본값 : false , String : emptyString , Number : 0 , flag variable
                let errMsg

                if(!field.length) errMsg = '노동자를 선택하세요.'
                else {
                    if(!field.val()) errMsg = field.attr('placeholder') + '입력하세요.'
                    else isGood = true
                }

                if(!isGood) {
                    $('#modalMsg').text(errMsg).css('color','red')
                    $('#modalBtn').hide()
                    $('#modal').modal('show')
                }

                return isGood
            }

            function listLaborers() {
                $('input').not(':radio').val('') // radio가 아닌걸 찾아낸후 emptyString 처리해서 처리해준다.
                $('#laborers').empty()

                if(laborers.length) {
                    const laborerArr = [] // buffer : 데이터가 잠시머무르는 공간
                    
                    $.each(laborers, (i, laborer) => {
                        laborerArr.unshift(
                            `<tr>
                                <td><input type='radio' value='${laborer.laborerId}' id='laborerId' name='laborerId'/></td>
                                <td>${laborer.laborerId}</td>
                                <td>${laborer.laborerName}</td>
                                <td>${laborer.hireDate}</td>
                            </tr>`
                        )
                    })

                    $('#laborers').append(laborerArr.join(''))
                } else $('#laborers').append('<tr><td colspan="4" class="text-center">노동자가 없습니다.</td></tr>')  // presentation logic
            }

            function init() { // 페이지가 시작하자마자 하는 작업을 의미
                // 노동자 추가
                $('#addLaborerBtn').click(() => {
                    if(isVal($('#laborerName')) && isVal($('#hireDate'))) {
                        let laborer = {
                            laborerId: laborerId.next().value,
                            laborerName: $('#laborerName').val(),
                            hireDate: $('#hireDate').val()
                        }

                        laborers.push(laborer)
                        listLaborers()
                    }
                })

                // 노동자 수정
                $('#fixLaborerBtn').click(() => {
                    if(isVal($('#laborerId:checked')) && isVal($('#laborerName')) && isVal($('#hireDate'))) {
                            let laborerId = $('#laborerId:checked').val()

                            let laborer = laborers.filter(laborer =>
                                laborer.laborerId == laborerId)[0]

                            if(laborer) { // 수정할 노동자가 있다면
                                laborer.laborerName = $('#laborerName').val()
                                laborer.hireDate = $('#hireDate').val()
                                listLaborers()
                            }
                        }
                })

                $('#laborers').on({ // .on : 해당객체의 자식들중에
                    change() {
                        $('#laborerName').val($(this).parent().next().next().text())
                        $('#hireDate').val($(this).parent().next().next().next().text())
                    }
                }, '#laborerId') // 자식들중에 laborerId를 가진.

                // 노동자 삭제
                $('#delLaborerBtn').click(() => {
                    if(isVal($('#laborerId:checked'))) {
                        $('#modalMsg').text('노동자를 삭제하시겠습니까?')
                        $('#modalBtn').show()
                        $('#modal').modal('show')
                    }
                })

                $('#delLaborerOkBtn').click(() => {
                    let laborerId = $('#laborerId:checked').val()

                    laborers = laborers.filter(laborer => laborer.laborerId != laborerId)

                    $('#modal').modal('hide')
                    listLaborers()
                })
            }

            $(init)  // call
        </script>
        <style>
            #hireDate::before {
                content: attr(placeholder);
                width: 100%;
            }

            #hireDate:focus::before, #hireDate:valid::before {
                display: none;
            }
        </style>
    </head>
    <body>
        <div class='container'>
            <div class='row mb-5'>
                <div class='col'>
                    <header class='p-2 bg-light shadow'>
                        <h1 class='text-center'><b>HR</b></h1>
                    </header>
                </div>
            </div>
            <div class='row'>
                <div class='col'>
                    <form>
                        <div class='row mb-3'>
                            <div class='col-2'>
                                <input type='text' class='form-control' placeholder='노동자명' id='laborerName'/>
                            </div>
                            <div class='col-5'>
                                <div class='row'>
                                    <div class='col-4 d-none d-md-inline text-end align-bottom pt-2'>
                                        <label for='hireDate'>입사일: </label>
                                    </div>
                                    <div class='col'>
                                        <input type='date' class='form-control' id='hireDate'
                                            placeholder='입사일' required/>
                                    </div>
                                </div>
                            </div>
                            <div class='col'>
                                <div class='d-flex gap-2 justify-content-end'>
                                    <button type='button' class='btn btn-primary col-4' id='addLaborerBtn'>
                                        <i class='bi bi-plus-circle'></i>
                                        <span class='label d-none d-md-inline'>&nbsp;추가</span>
                                    </button>
                                    <button type='button' class='btn btn-success col-4' id='fixLaborerBtn'>
                                        <i class='bi bi-check-circle'></i>
                                        <span class='label d-none d-md-inline'>&nbsp;수정</span>
                                    </button>
                                    <button type='button' class='btn btn-danger col-4' id='delLaborerBtn'>
                                        <!-- data-bs-toggle='modal' data-bs-target='#delLaborerModal'> -->
                                        <i class='bi bi-x-circle'></i>
                                        <span class='label d-none d-md-inline'>&nbsp;삭제</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class='row'>
                            <div class='col'>
                                <table class='table'>
                                    <thead class='table-warning'>
                                        <tr><th></th><th>ID</th><th>이름</th><th>입사일</th></tr>
                                    </thead>
                                    <tbody id='laborers'>
                                        <tr><td colspan='4' class='text-center'>노동자가 없습니다.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class='modal fade' id='modal'>
            <div class='modal-dialog'>
                <div class='modal-content'>
                    <div class='modal-header'>
                        <button type='button' class='btn-close' data-bs-dismiss='modal'></button>
                    </div>
                    <div class='modal-body'>
                        <!--<p>노동자를 삭제하시겠습니까?</p>-->
                        <p id='modalMsg'></p>
                    </div>
                    <div class='modal-footer' id='modalBtn'>
                        <button type='button' class='btn btn-primary' id='delLaborerOkBtn'>예</button>
                        <button type='button' class='btn btn-secondary' 
                            data-bs-dismiss='modal'>아니오</button>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>